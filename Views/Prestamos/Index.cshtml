@model List<BibliotecaWeb.Models.Prestamo>
@{
    ViewData["Title"] = "Mis Pr√©stamos";
}

<div class="container mt-4">
    <h2>üìí Mis Pr√©stamos</h2>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    @if (!Model.Any())
    {
        <div class="alert alert-info">
            No tienes pr√©stamos activos.
        </div>
    }
    else
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Libro</th>
                    <th>Fecha Pr√©stamo</th>
                    <th>Vence el</th>
                    <th>Fecha Devoluci√≥n</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var prestamo in Model)
                {
                    var estaRetrasado = prestamo.Estado == "Activo" && prestamo.FechaVencimiento < DateTime.Now;
                    <tr class="@(estaRetrasado ? "table-danger" : "")">
                        <td>@prestamo.Libro.Titulo</td>
                        <td>@prestamo.FechaPrestamo.ToString("dd/MM/yyyy")</td>
                        <td>
                            <strong>@prestamo.FechaVencimiento.ToString("dd/MM/yyyy")</strong>
                            @if (estaRetrasado)
                            {
                                <br><small class="text-danger">‚ö†Ô∏è RETRASADO</small>
                            }
                        </td>
                        <td>
                            @if (prestamo.FechaDevolucion.HasValue)
                            {
                                @prestamo.FechaDevolucion.Value.ToString("dd/MM/yyyy")
                            }
                            else
                            {
                                <span class="text-muted">Pendiente</span>
                            }
                        </td>
                        <td>
                            @if (prestamo.Estado == "Activo")
                            {
                                <span class="badge badge-warning">@prestamo.Estado</span>
                            }
                            else if (prestamo.Estado == "Retrasado")
                            {
                                <span class="badge badge-danger">@prestamo.Estado</span>
                            }
                            else
                            {
                                <span class="badge badge-success">@prestamo.Estado</span>
                            }
                        </td>
                        <td>
                            @if (prestamo.Estado == "Activo" || prestamo.Estado == "Retrasado")
                            {
                                <a href="/Prestamos/Devolver/@prestamo.PrestamoID" 
                                   class="btn btn-success btn-sm" 
                                   onclick="return confirm('¬øEst√°s seguro de devolver este libro?')">
                                    üì§ Devolver
                                </a>
                            }
                            else
                            {
                                <span class="text-muted">Finalizado</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }

    <div class="mt-3">
        <a href="/Prestamos/Create" class="btn btn-primary">üì• Solicitar Nuevo Pr√©stamo</a>
        <a href="/Libros" class="btn btn-info">üìö Ver Todos los Libros</a>
        <a href="/Home" class="btn btn-secondary">‚Üê Volver al Dashboard</a>
    </div>
</div>